<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0"><meta property="og:site_name" content="KCN&#39;s Blog"/>
<meta property="og:title" content="Logback è‡ªåŠ¨ Json åºåˆ—åŒ–å’Œè½¬æ¢å™¨åŸç†è§£æ"/>
<meta property="og:description" content="å¦‚ä½•è‡ªåŠ¨å¯¹å¯¹è±¡è¿›è¡Œ json åºåˆ—åŒ– å‰æƒ…æè¦ java å¼€å‘ä¸­ï¼Œå¤§å®¶ä¸€èˆ¬éƒ½ä¼šç”¨ Slf4j&#43;logback çš„ç»„åˆæ¥å†™æ—¥å¿—ã€‚æˆ‘ä¹Ÿæ˜¯ã€‚ logback æœ‰ä¸ªå¾ˆæ–¹ä¾¿çš„åŠŸèƒ½ï¼šå½“ä½ å ä½ç¬¦å¯¹åº”çš„å‚æ•°æ˜¯ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œ"/>
<meta property="og:locale" content="zh_CN"/>
<meta property="og:url" content="https://kushnee.github.io/series/java/logback-%E8%87%AA%E5%8A%A8-json-%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E8%BD%AC%E6%8D%A2%E5%99%A8%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/"/>
<meta property="og:image" content="https://kushnee.github.io//images/favicon.ico"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time"   content="2023-08-19 23:44:42 &#43;0800 CST"/>
<meta property="article:modified_time" content="2022-11-28 16:53:08 &#43;0800 CST"/>
<meta property="article:expiration_time" content="0001-01-01 00:00:00 &#43;0000 UTC"/>
<meta property="article:author" content="Kush Nee"/>
<meta property="article:tag" content="logback converter "/>
<meta property="article:section" content=""/><title>Logback è‡ªåŠ¨ Json åºåˆ—åŒ–å’Œè½¬æ¢å™¨åŸç†è§£æ | KCN&#39;s Blog</title><link href="/css/root.css" rel="stylesheet">
<link href="/css/sidebar.css" rel="stylesheet">
<link href="/css/main.css" rel="stylesheet">
<link href="/css/page.css" rel="stylesheet">
<link href="/css/scrollbar.css" rel="stylesheet">
<link href="/css/tags.css" rel="stylesheet">
<link href="/css/fastsearch.css" rel="stylesheet">
<link href="/css/print.css" rel="stylesheet">
<link href="/css/message.css" rel="stylesheet">
<link href="https://cdn.bootcdn.net/ajax/libs/font-awesome/6.2.0/css/all.min.css" rel="stylesheet">
<link href="https://cdn.bootcdn.net/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Marck+Script&family=Andada+Pro:ital,wght@0,400;0,700;1,400;1,700&family=Indie+Flower&family=JetBrains+Mono:ital,wght@0,400;0,700;1,400;1,700&family=Noto+Sans+SC:wght@400;700&family=Noto+Serif+SC:wght@400;700&family=Roboto:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet"><link rel="shortcut icon" href="/images/favicon.ico" type="image/vnd.microsoft.icon" />
<link rel="icon" href="/images/favicon.ico" type="image/vnd.microsoft.icon" /><script src="/js/jquery-3.6.0.min.js"></script>
</head>
<body class="site-root" id="SiteRoot">
  <div id="preload-mask">
    <div class="lds-default"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div>
  </div>
  <div class="site-inner" id="SiteInner">
    <header class="site-header" id="SiteHeader"><h1 class="site-title">KCN&#39;s Blog</h1><ul class="main-menu"><li class="menu-item"><a href="/"><i class="fas fa-home"></i>Home</a></li><li class="menu-item"><a href="/about/"><i class="fas fa-user"></i>About</a></li><li class="menu-item"><a href="/tags/"><i class="fas fa-tags"></i>Tags</a></li><li class="menu-item"><a href="/series/"><i class="fas fa-book"></i>Series</a></li><li class="menu-item search" id="searchBtn"><i class="fas fa-search"></i>CTRL-/</li>
  </ul></header>
    <div class="site-main" id="SiteMain">
      <div class="site-left" data-pjax></div>
      <div class="site-message-list" id="MessageList"></div>
      <div class="site-content" data-pjax id="SiteContent"><h1 class="article-title">Logback è‡ªåŠ¨ Json åºåˆ—åŒ–å’Œè½¬æ¢å™¨åŸç†è§£æ</h1>
  <div class="article-metadata"><ul class="meta-section"><li class="meta-item">
      <i class="fas fa-upload"></i>
      <span class="meta-item-text">Published on</span>
      <span class="meta-item-value">2023-08-19</span>
  </li><li class="meta-item">
    <i class="fas fa-file-pen"></i>
    <span class="meta-item-text">Modified on</span>
    <span class="meta-item-value">2022-11-28</span>
  </li></ul><ul class="meta-section"><li class="meta-item">
        <i class="fas fa-tags"></i>
        <span class="meta-item-text">Tags:</span>
        <span class="meta-item-value"><a class="tag" href="/tags/logback">logback</a>, <a class="tag" href="/tags/converter">converter</a></span>
      </li><li class="meta-item"><i class="fas fa-folder-open"></i>
        <span class="meta-item-text">In</span>
        <a class="meta-item-value" href="/series/java/">Java</a>
      </li></ul><ul class="meta-section">
    <li class="meta-item">
      <i class="far fa-file-word"></i>
      <span class="meta-item-text">Word count â‰ˆ</span>
      <span class="meta-item-value">2300</span>
    </li>
    <li class="meta-item">
      <i class="fas fa-hourglass-start"></i>
      <span class="meta-item-text">Reading time â‰ˆ</span>
      <span class="meta-item-value">5 min</span></li>
  </ul></div><div class="article-content"><h2 class="heading" id="å¦‚ä½•è‡ªåŠ¨å¯¹å¯¹è±¡è¿›è¡Œ-json-åºåˆ—åŒ–">
  <a href="#%e5%a6%82%e4%bd%95%e8%87%aa%e5%8a%a8%e5%af%b9%e5%af%b9%e8%b1%a1%e8%bf%9b%e8%a1%8c-json-%e5%ba%8f%e5%88%97%e5%8c%96">å¦‚ä½•è‡ªåŠ¨å¯¹å¯¹è±¡è¿›è¡Œ json åºåˆ—åŒ–</a>
</h2><h3 class="heading" id="å‰æƒ…æè¦">
  <a href="#%e5%89%8d%e6%83%85%e6%8f%90%e8%a6%81">å‰æƒ…æè¦</a>
</h3><p>java å¼€å‘ä¸­ï¼Œå¤§å®¶ä¸€èˆ¬éƒ½ä¼šç”¨ Slf4j+logback çš„ç»„åˆæ¥å†™æ—¥å¿—ã€‚æˆ‘ä¹Ÿæ˜¯ã€‚</p>
<p>logback æœ‰ä¸ªå¾ˆæ–¹ä¾¿çš„åŠŸèƒ½ï¼šå½“ä½ å ä½ç¬¦å¯¹åº”çš„å‚æ•°æ˜¯ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œå®ƒä¼šè‡ªåŠ¨è°ƒç”¨è¯¥å¯¹è±¡çš„ toString æ–¹æ³•è¿›è¡Œåºåˆ—åŒ–ï¼Œä¸ç”¨ä½ æ‰‹åŠ¨åšè°ƒç”¨ã€‚</p>
<p>è¿™ä¸ªå·²ç»æŒºæ–¹ä¾¿äº†ï¼Œä½†æ˜¯è¿™æ ·å­çš„æ•°æ®å±•ç¤ºæ–¹å¼è¿˜æ˜¯æœ‰å±€é™æ€§ã€‚å½“ä½ éœ€è¦æŠŠä¸€æ®µæ•°æ®æ‹¿å‡ºæ¥ç»™å…¶ä»–è¯­è¨€çš„åç«¯ã€å‰ç«¯ï¼Œç”šè‡³æ˜¯ä¸šåŠ¡å’Œè¿è¥çœ‹çš„æ—¶å€™ï¼Œä¸€æ®µ raw çš„æ•°æ®ï¼Œå¯¹æ–¹å¾ˆå¯èƒ½å°±æ‹’ç»äº†ã€‚</p>
<p>è¿™ä¸ªæ—¶å€™æˆ‘å°±æƒ³åˆ°ï¼Œjson æ˜¯ä¸€ç§æ›´é€šç”¨çš„æ•°æ®æ ¼å¼å•Šã€‚java é‡Œæœ¬èº«å°±æœ‰å¾ˆå¤šæ–¹ä¾¿å¿«æ·çš„ json æ¡†æ¶ç›´æ¥ä½¿ç”¨ï¼Œè€Œä¸”å°±ç®—ä½ æ‹¿å‡ºæ¥çš„è¿˜æ˜¯ä¸€è¡Œæ•°æ®ï¼Œç°åœ¨ç½‘ä¸Šæœ‰é‚£ä¹ˆå¤š json ç¾åŒ–å·¥å…·ï¼ŒæŸ¥çœ‹çš„é—¨æ§›å…¶å®å¾ˆä½çš„ã€‚</p>
<h3 class="heading" id="æ–¹æ¡ˆè®¾è®¡">
  <a href="#%e6%96%b9%e6%a1%88%e8%ae%be%e8%ae%a1">æ–¹æ¡ˆè®¾è®¡</a>
</h3><p>ç¡®å®šäº†éœ€è¦è½¬æ¢çš„æ ¼å¼ä¹‹åï¼Œå°±æ˜¯ç¡®å®šå®ç°ç»†èŠ‚äº†ã€‚åˆšå¼€å§‹å…¶å®æˆ‘æƒ³çš„æ˜¯å†™ä¸ªåˆ‡é¢ï¼Œä½†æ˜¯å¾ˆå¿«å°±æ„è¯†åˆ°è¿™æ ·å¹¶ä¸ä¼˜é›…ã€‚</p>
<p>ä¸ºäº†æ“ä½œåˆ°æ‰€æœ‰çš„æ—¥å¿—ï¼Œä½ è‚¯å®šéœ€è¦æŠŠåˆ‡ç‚¹ç»‡å…¥ logback çš„ç›¸å…³æ–¹æ³•ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯ <code>ch.qos.logback.classic.Logger</code> è¿™ä¸ªç±»çš„æ–¹æ³•ä¸­ã€‚é‚£ä¹ˆå¤šæ–¹æ³•é‡è½½ï¼Œçœ‹ç€éƒ½å¿ƒç´¯ã€‚ã€‚ã€‚</p>
<p>å½“ç„¶ï¼Œç”¨åˆ‡é¢è‚¯å®šèƒ½å®ç°è‡ªåŠ¨ json åºåˆ—åŒ–ï¼Œä½†æ˜¯æˆ‘æƒ³åšçš„å…¶å®æ˜¯ã€Œæ›¿æ¢æ‰æ—¥å¿—è¾“å‡ºä¸­çš„åºåˆ—åŒ–ä¸€ç¯ã€ï¼Œè€Œä¸æ˜¯ã€Œåœ¨å†™æ—¥å¿—å‰åŠ ä¸€ä¸ªç»Ÿä¸€æ“ä½œã€ã€‚ä¸¤è€…çš„å«ä¹‰å¹¶ä¸ä¸€æ ·ï¼Œå‰è€…æ˜¯å¯¹æ—¥å¿—æ¡†æ¶çš„ä¿®æ”¹ï¼Œåè€…æ˜¯å¯¹é¡¹ç›®æœ¬èº«çš„ä¿®æ”¹ã€‚</p>
<p>æ‰€å¹¸ï¼Œåæ¥è¢«æˆ‘æ‰¾åˆ°äº† logback æœ¬èº«çš„ hook-è½¬æ¢å™¨ï¼Œå¯ä»¥åœ¨å†…éƒ¨è¿›è¡Œ json æ–¹æ³•çš„è°ƒç”¨ã€‚</p>
<h3 class="heading" id="å…·ä½“å®ç°">
  <a href="#%e5%85%b7%e4%bd%93%e5%ae%9e%e7%8e%b0">å…·ä½“å®ç°</a>
</h3><p>ç½‘ä¸Šæ‰¾åˆ°ä¸€ç¯‡è‡ªå®šä¹‰ MessageConverter çš„æ–‡ç« ï¼š<a href="https://www.hollischuang.com/archives/3689" target="_blank" rel="external">è‡ªå®šä¹‰ä¸€ä¸ª logback çš„ MessageConverter</a>ã€‚</p>
<p>åŸæ–‡ç”¨çš„æ˜¯ fastjsonã€‚è™½ç„¶å…¬å¸å¤§é‡ç”¨çš„éƒ½æ˜¯è¿™ä¸ª json æ¡†æ¶ï¼Œä½†æˆ‘è‡ªå·±çš„é¡¹ç›®ä¸ºäº†å‡å°‘ä¾èµ–ï¼Œä¼šç›´æ¥ä½¿ç”¨ <code>spring-boot-starter-web</code> é‡Œçš„ jacksonã€‚ä¸‹é¢è´´å‡ºæˆ‘çš„ä¿®æ”¹ç‰ˆï¼š</p>
<ol>
<li>è‡ªå®šä¹‰ä¸€ä¸ª converterï¼š</li>
</ol>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#268bd2">public</span> <span style="color:#268bd2">class</span> <span style="color:#268bd2">JsonConverter</span> <span style="color:#268bd2">extends</span> MessageConverter <span style="color:#719e07">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">private</span> <span style="color:#268bd2">final</span> <span style="color:#268bd2">static</span> ObjectMapper OBJECT_MAPPER <span style="color:#719e07">=</span> <span style="color:#719e07">new</span> ObjectMapper<span style="color:#719e07">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">public</span> String <span style="color:#268bd2">convert</span><span style="color:#719e07">(</span>ILoggingEvent event<span style="color:#719e07">)</span> <span style="color:#719e07">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#719e07">try</span> <span style="color:#719e07">{</span>
</span></span><span style="display:flex;"><span>            List<span style="color:#719e07">&lt;</span>Object<span style="color:#719e07">&gt;</span> list <span style="color:#719e07">=</span> <span style="color:#719e07">new</span> ArrayList<span style="color:#719e07">&lt;&gt;();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#719e07">for</span> <span style="color:#719e07">(</span>Object argument <span style="color:#719e07">:</span> event<span style="color:#719e07">.</span>getArgumentArray<span style="color:#719e07">())</span> <span style="color:#719e07">{</span>
</span></span><span style="display:flex;"><span>                Object o <span style="color:#719e07">=</span> <span style="color:#719e07">(</span>argument<span style="color:#719e07">.</span>getClass<span style="color:#719e07">().</span>getClassLoader<span style="color:#719e07">()</span> <span style="color:#719e07">!=</span> <span style="color:#cb4b16">null</span> <span style="color:#719e07">||</span> argument <span style="color:#719e07">instanceof</span> Collection
</span></span><span style="display:flex;"><span>                    <span style="color:#719e07">||</span> argument <span style="color:#719e07">instanceof</span> Map<span style="color:#719e07">)</span> <span style="color:#719e07">?</span> OBJECT_MAPPER<span style="color:#719e07">.</span>writeValueAsString<span style="color:#719e07">(</span>argument<span style="color:#719e07">)</span> <span style="color:#719e07">:</span> argument<span style="color:#719e07">;</span>
</span></span><span style="display:flex;"><span>                list<span style="color:#719e07">.</span>add<span style="color:#719e07">(</span>o<span style="color:#719e07">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#719e07">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#719e07">return</span> MessageFormatter<span style="color:#719e07">.</span>arrayFormat<span style="color:#719e07">(</span>event<span style="color:#719e07">.</span>getMessage<span style="color:#719e07">(),</span> list<span style="color:#719e07">.</span>toArray<span style="color:#719e07">()).</span>getMessage<span style="color:#719e07">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#719e07">}</span> <span style="color:#719e07">catch</span> <span style="color:#719e07">(</span>Exception e<span style="color:#719e07">)</span> <span style="color:#719e07">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#719e07">return</span> <span style="color:#268bd2">super</span><span style="color:#719e07">.</span>convert<span style="color:#719e07">(</span>event<span style="color:#719e07">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#719e07">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#719e07">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#719e07">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>æ·»åŠ è‡ªå®šä¹‰ converter åˆ° logback-spring.xml é…ç½®æ–‡ä»¶ä¸­</li>
</ol>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#268bd2">&lt;configuration&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">&lt;conversionRule</span> conversionWord=<span style="color:#2aa198">&#34;msg&#34;</span> converterClass=<span style="color:#2aa198">&#34;xxx.xxx.xxx.config.JsonConverter&#34;</span><span style="color:#268bd2">/&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">&lt;/configuration&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 class="heading" id="logback-è½¬æ¢å™¨åŸç†åˆ†æ">
  <a href="#logback-%e8%bd%ac%e6%8d%a2%e5%99%a8%e5%8e%9f%e7%90%86%e5%88%86%e6%9e%90">logback è½¬æ¢å™¨åŸç†åˆ†æ</a>
</h2><p>è™½ç„¶è¿™æ ·å¯ä»¥è‡ªåŠ¨åºåˆ—åŒ–äº†ï¼Œä½†æˆ‘è¿˜æ˜¯æœ‰ä¸å°‘ç–‘é—®ï¼š</p>
<p>MessageConverter å·²ç»æ˜¯ä¸€ä¸ªå…·ä½“çš„ç±»äº†ï¼Œä¸ºä»€ä¹ˆè¦ç»§æ‰¿å®ƒè€Œä¸æ˜¯å®ƒçš„çˆ¶ç±» ClassicConverter å‘¢ï¼Ÿä¸ºä»€ä¹ˆåªè¦åœ¨é…ç½®æ–‡ä»¶é‡Œæ·»åŠ  conversionRule å°±èƒ½è¢« logback ä½¿ç”¨å‘¢ï¼Ÿå¦‚æœå¯¹ä¸€ä¸ªå…³é”®å­—æ·»åŠ äº†å¤šä¸ªè½¬æ¢å™¨ï¼Œå®ƒä»¬æ˜¯æ€ä¹ˆè¢«è°ƒç”¨çš„å‘¢ï¼Ÿ</p>
<p>è¿™äº›ç­”æ¡ˆï¼Œéƒ½åªèƒ½é çœ‹æºç äº†ã€‚</p>
<h3 class="heading" id="springboot-åŠ è½½-logback-é…ç½®æ–‡ä»¶">
  <a href="#springboot-%e5%8a%a0%e8%bd%bd-logback-%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6">springboot åŠ è½½ logback é…ç½®æ–‡ä»¶</a>
</h3><p>springboot æ˜¯ä½¿ç”¨ LoggingApplicationListener è¿™ä¸ªç±»å®Œæˆå¯¹æ—¥å¿—ç³»ç»Ÿåˆå§‹åŒ–çš„ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹è¿™ä¸ªç±»ï¼Œé¡ºä¾¿è¿˜èƒ½ç†è§£æ€ä¹ˆè‡ªåŠ¨è£…é…çš„ logback-spring.xml æ–‡ä»¶ã€‚</p>
<p>å½“ç„¶ï¼Œå…ˆæ”¾å¼ æ—¶åºå›¾ä¾¿äºç†è§£ï¼š<br />
<div class="image-wrap">
    <img src="%e5%8a%a0%e8%bd%bd%e6%b5%81%e7%a8%8b.png" alt="åŠ è½½æµç¨‹"  data-fancybox data-src="%e5%8a%a0%e8%bd%bd%e6%b5%81%e7%a8%8b.png"/>
</div></p>
<p>é¦–å…ˆï¼Œ<code>LoggingApplicationListerner</code>ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼ç›‘å¬åˆ° spring åº”ç”¨å¯åŠ¨åçš„ç¯å¢ƒå‡†å¤‡äº‹ä»¶ï¼š<code>ApplicationEnvironmentPreparedEvent</code>ï¼Œç„¶åå°±ä¼šå»æ‰§è¡Œç›¸å…³çš„åˆå§‹åŒ–æ“ä½œï¼Œè·å–é…ç½®æ–‡ä»¶ã€‚</p>
<p>è·å–é…ç½®æ–‡ä»¶çš„æ­¥éª¤å°±æ˜¯ spring çš„ç‰¹æ®ŠåŒ–å¤„ç†ã€‚å®ƒä¼šå…ˆåœ¨<code>getSelfInitializationConfig</code>æŸ¥æ‰¾ logback çš„æ ‡å‡†é…ç½®æ–‡ä»¶ï¼š&ldquo;logback-test.groovy&rdquo;, &ldquo;logback-test.xml&rdquo;, &ldquo;logback.groovy&rdquo;, â€œlogback.xml&quot;ã€‚å¦‚æœè¿™äº›æ–‡ä»¶éƒ½æ²¡æœ‰æ‰¾åˆ°ï¼Œspring ä¼šå»åšä¸€ä¸ªæ–‡ä»¶åçš„ä¿®æ”¹ï¼Œå†å»è·å–ï¼š</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#586e75">/**
</span></span></span><span style="display:flex;"><span><span style="color:#586e75"> * Return the spring config locations for this system. By default this method returns
</span></span></span><span style="display:flex;"><span><span style="color:#586e75"> * a set of locations based on {@link #getStandardConfigLocations()}.
</span></span></span><span style="display:flex;"><span><span style="color:#586e75"> * @return the spring config locations
</span></span></span><span style="display:flex;"><span><span style="color:#586e75"> * @see #getSpringInitializationConfig()
</span></span></span><span style="display:flex;"><span><span style="color:#586e75"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">protected</span> String<span style="color:#719e07">[]</span> <span style="color:#268bd2">getSpringConfigLocations</span><span style="color:#719e07">()</span> <span style="color:#719e07">{</span>
</span></span><span style="display:flex;"><span>    String<span style="color:#719e07">[]</span> locations <span style="color:#719e07">=</span> getStandardConfigLocations<span style="color:#719e07">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#719e07">for</span> <span style="color:#719e07">(</span><span style="color:#dc322f">int</span> i <span style="color:#719e07">=</span> 0<span style="color:#719e07">;</span> i <span style="color:#719e07">&lt;</span> locations<span style="color:#719e07">.</span>length<span style="color:#719e07">;</span> i<span style="color:#719e07">++)</span> <span style="color:#719e07">{</span>
</span></span><span style="display:flex;"><span>        String extension <span style="color:#719e07">=</span> StringUtils<span style="color:#719e07">.</span>getFilenameExtension<span style="color:#719e07">(</span>locations<span style="color:#719e07">[</span>i<span style="color:#719e07">]);</span>
</span></span><span style="display:flex;"><span>        locations<span style="color:#719e07">[</span>i<span style="color:#719e07">]</span> <span style="color:#719e07">=</span> locations<span style="color:#719e07">[</span>i<span style="color:#719e07">].</span>substring<span style="color:#719e07">(</span>0<span style="color:#719e07">,</span> locations<span style="color:#719e07">[</span>i<span style="color:#719e07">].</span>length<span style="color:#719e07">()</span> <span style="color:#719e07">-</span> extension<span style="color:#719e07">.</span>length<span style="color:#719e07">()</span> <span style="color:#719e07">-</span> 1<span style="color:#719e07">)</span> <span style="color:#719e07">+</span> <span style="color:#2aa198">&#34;-spring.&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#719e07">+</span> extension<span style="color:#719e07">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#719e07">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#719e07">return</span> locations<span style="color:#719e07">;</span>
</span></span><span style="display:flex;"><span><span style="color:#719e07">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å®ƒä¼šæŠŠå­—ç¬¦ä¸²æ‹†æˆä¸¤éƒ¨åˆ†ï¼Œ<code>.</code>å‰çš„éƒ¨åˆ†ï¼Œå’Œ<code>.</code>åçš„éƒ¨åˆ†ï¼ˆextensionï¼‰ï¼Œç„¶ååœ¨ä¸¤è€…ä¹‹é—´åŠ ä¸Š<code>-spring.</code>ç»„æˆæ–°çš„å­—ç¬¦ä¸²ã€‚logback.xml -&gt; logback-spring.xmlã€‚</p>
<p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¯´æ²¡æœ‰ logback.xml æ–‡ä»¶çš„æ—¶å€™ spring ä¼šè‡ªåŠ¨å»æ‰¾ logback-spring.xml æ–‡ä»¶çš„åŸå› ï¼Œä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå­˜åœ¨äº† logback.xml å logback-spring.xml é…ç½®å°±ä¼šå¤±æ•ˆã€‚</p>
<h3 class="heading" id="logback-å®Œæˆé…ç½®åˆå§‹åŒ–">
  <a href="#logback-%e5%ae%8c%e6%88%90%e9%85%8d%e7%bd%ae%e5%88%9d%e5%a7%8b%e5%8c%96">logback å®Œæˆé…ç½®åˆå§‹åŒ–</a>
</h3><p><code>loadConfiguration</code>æ–¹æ³•ä¼šåœ¨å®Œæˆå‰ç½®åŠ¨ä½œåï¼ŒæŠŠç›¸å…³ä¿¡æ¯äº¤è¿˜ç»™ logbackï¼Œlogback ä¼šä½¿ç”¨ <code>JoranConfigurator</code> è¿›è¡Œé…ç½®åˆå§‹åŒ–ã€‚</p>
<p>æ¥ï¼Œå†æ¥ä¸ªæ—¶åºå›¾(åªä¼šæä¾›è½¬æ¢å™¨ç›¸å…³åˆå§‹åŒ–çš„è¿‡ç¨‹ï¼Œå…¶ä»–å…ƒç´ çš„åŠ¨ä½œè¢«çœç•¥äº†ï¼‰ï¼š<br />
<div class="image-wrap">
    <img src="%e5%88%9d%e5%a7%8b%e5%8c%96%e6%b5%81%e7%a8%8b.png" alt="åˆå§‹åŒ–æµç¨‹"  data-fancybox data-src="%e5%88%9d%e5%a7%8b%e5%8c%96%e6%b5%81%e7%a8%8b.png"/>
</div></p>
<p>ç»†èŠ‚ä¸Šï¼ŒSaxEventRecorder åœ¨è¿›è¡Œ <code>recordEvents </code> æ—¶ä¼šåˆ›å»ºä¸€ä¸ª <code>SAXParser</code> ç”¨äºè§£æ xml æ–‡ä»¶ï¼Œç„¶åå†è°ƒç”¨é‡è½½çš„ <code>startElement</code> æ–¹æ³•æŠŠç›¸å…³çš„ startElement æ”¾åˆ°ä¸€ä¸ª list ä¸­ã€‚<div class="image-wrap">
    <img src="https://i.loli.net/2021/02/16/JnIVijaOpm3fCsc.png" alt="image-20210216142528250"  data-fancybox data-src="https://i.loli.net/2021/02/16/JnIVijaOpm3fCsc.png"/>
</div></p>
<p>startElement æ–¹æ³•ä¸­ï¼Œå…ˆè¿‡æ»¤å‡ºç›¸å…³ tag çš„ actionï¼Œç„¶åè°ƒç”¨ callBeginAction ä¾æ¬¡æ‰§è¡Œå…·ä½“ action çš„ begin æ–¹æ³•ã€‚åœ¨æˆ‘ä»¬è¿™å„¿ï¼Œå°±æ˜¯ ConversionRuleActionã€‚</p>
<p>åœ¨ ConversionRuleAction ä¸­ï¼Œä¼šæå– conversionWord å’Œ conversionClassï¼Œç„¶åæŠŠè¿™ä¸¤ä¸ªå­—æ®µä½œä¸ºä¸€å¯¹ KVï¼Œæ’å…¥ä¸€ä¸ªå« ruleResigtry çš„ hashMap ä¸­ã€‚è€Œ ruleResigtry æœ¬èº«ï¼Œåˆ™ä¼šè¢«ä¿å­˜åœ¨ logback å…¨å±€çš„ context ä¸­ã€‚<div class="image-wrap">
    <img src="https://i.loli.net/2021/02/16/KcNynJtMI4SQzR6.png" alt="image-20210216144833091"  data-fancybox data-src="https://i.loli.net/2021/02/16/KcNynJtMI4SQzR6.png"/>
</div></p>
<p>å†åŠ ä¹‹åçš„ä¸€äº›éªŒè¯ã€ä¸Šä¸‹æ–‡ä¿¡æ¯è¡¥å…¨çš„æ“ä½œï¼Œlogback å°±æŠŠä¸€ä¸ªé…ç½®æ–‡ä»¶çš„å†…å®¹ååºåˆ—åŒ–åˆ°ä¸Šä¸‹æ–‡ä¸­äº†ã€‚</p>
<div class="tab info"><div class="tab-sum"><span class="tab-sum-content">tip</span></div><div class="tab-content">è¿™é‡Œä¹Ÿèƒ½çœ‹å‡ºä¸€ä¸ªç»“è®ºï¼Œå½“ä½ å¯¹åŒä¸€ä¸ª conversionWord æä¾›äº†å¤šä¸ªä¸åŒçš„è½¬æ¢å™¨çš„æ—¶å€™ï¼Œåªæœ‰æœ€åä¸€ä¸ªä¼šç”Ÿæ•ˆã€‚å› ä¸ºä¾æ¬¡å¯¹ conversionRule æ‰§è¡ŒConversionRuleAction#beginï¼Œæ–°çš„ä¸€ä¸ªè½¬æ¢å™¨ä¼šè¦†ç›–æ‰ ruleRegistry ä¸­ç›¸åŒ key çš„å€¼ã€‚ï¼ˆhashMap#put çš„åŸºæœ¬çŸ¥è¯†ï¼‰</div>
</div>
<h3 class="heading" id="logger-çš„å…·ä½“è°ƒç”¨">
  <a href="#logger-%e7%9a%84%e5%85%b7%e4%bd%93%e8%b0%83%e7%94%a8">Logger çš„å…·ä½“è°ƒç”¨</a>
</h3><p>æœ€ååœ¨å®é™…ä½¿ç”¨ä¸Šçš„æµç¨‹ï¼š<br />
<div class="image-wrap">
    <img src="%e8%b0%83%e7%94%a8%e6%b5%81%e7%a8%8b.png" alt="è°ƒç”¨æµç¨‹"  data-fancybox data-src="%e8%b0%83%e7%94%a8%e6%b5%81%e7%a8%8b.png"/>
</div></p>
<p>è€Œ PatternLayout ç»§æ‰¿çš„ PatternLayoutBase ä¼šåœ¨è‡ªèº«åˆå§‹åŒ–çš„æ—¶å€™ï¼Œè§£æé…ç½®æ–‡ä»¶ä¸­çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œç„¶åå°†å…³é”®å­—å¯¹åº”çš„è½¬æ¢å™¨æ·»åŠ åˆ°ä¸€æ¡é“¾è¡¨ä¸­ã€‚æ‰€ä»¥åœ¨æ‰§è¡Œ writeLoopOnConverters çš„æ—¶å€™ï¼Œå°±æ˜¯ä¾æ¬¡æ‰§è¡Œè¿™äº›è½¬æ¢å™¨ï¼Œæœ€ååå‡ºä¸€æ¡è½¬æ¢å®Œçš„å­—ç¬¦ä¸²ã€‚<strong>ï¼ˆå…·ä½“åˆå§‹åŒ–çš„è°ƒç”¨åœ¨å“ªè¿˜æ²¡çœ‹åˆ°ï¼Œä¹‹åçœ‹å®Œäº†å†é‡æ–°å†™ä¸€ç¯‡å§ï¼‰</strong></p>
<h2 class="heading" id="æ€»ç»“">
  <a href="#%e6%80%bb%e7%bb%93">æ€»ç»“</a>
</h2><p>å¦‚æœä½ åªæ˜¯éœ€è¦æ·»åŠ  json åºåˆ—åŒ–çš„è¯ï¼Œä¸ç”¨ç»§æ‰¿ MessageConverterï¼Œç›´æ¥ç»§æ‰¿ ClassicConverter ç„¶åæä¾›ç›¸å…³çš„è‡ªå®šä¹‰é…ç½®å°±å¯ä»¥äº†ã€‚å½“ç„¶åˆ«å¿˜äº†å†é…ç½®æ–‡ä»¶é‡ŒåŠ ä¸Š conversionRuleã€‚</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#268bd2">public</span> <span style="color:#268bd2">class</span> <span style="color:#268bd2">JsonConverter</span> <span style="color:#268bd2">extends</span> ClassicConverter <span style="color:#719e07">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">private</span> <span style="color:#268bd2">final</span> <span style="color:#268bd2">static</span> ObjectMapper OBJECT_MAPPER <span style="color:#719e07">=</span> <span style="color:#719e07">new</span> ObjectMapper<span style="color:#719e07">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">public</span> String <span style="color:#268bd2">convert</span><span style="color:#719e07">(</span>ILoggingEvent event<span style="color:#719e07">)</span> <span style="color:#719e07">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#719e07">try</span> <span style="color:#719e07">{</span>
</span></span><span style="display:flex;"><span>            List<span style="color:#719e07">&lt;</span>Object<span style="color:#719e07">&gt;</span> list <span style="color:#719e07">=</span> <span style="color:#719e07">new</span> ArrayList<span style="color:#719e07">&lt;&gt;();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#719e07">for</span> <span style="color:#719e07">(</span>Object argument <span style="color:#719e07">:</span> event<span style="color:#719e07">.</span>getArgumentArray<span style="color:#719e07">())</span> <span style="color:#719e07">{</span>
</span></span><span style="display:flex;"><span>                Object o <span style="color:#719e07">=</span> <span style="color:#719e07">(</span>argument<span style="color:#719e07">.</span>getClass<span style="color:#719e07">().</span>getClassLoader<span style="color:#719e07">()</span> <span style="color:#719e07">!=</span> <span style="color:#cb4b16">null</span> <span style="color:#719e07">||</span> argument <span style="color:#719e07">instanceof</span> Collection
</span></span><span style="display:flex;"><span>                    <span style="color:#719e07">||</span> argument <span style="color:#719e07">instanceof</span> Map<span style="color:#719e07">)</span> <span style="color:#719e07">?</span> OBJECT_MAPPER<span style="color:#719e07">.</span>writeValueAsString<span style="color:#719e07">(</span>argument<span style="color:#719e07">)</span> <span style="color:#719e07">:</span> argument<span style="color:#719e07">;</span>
</span></span><span style="display:flex;"><span>                list<span style="color:#719e07">.</span>add<span style="color:#719e07">(</span>o<span style="color:#719e07">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#719e07">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#719e07">return</span> MessageFormatter<span style="color:#719e07">.</span>arrayFormat<span style="color:#719e07">(</span>event<span style="color:#719e07">.</span>getMessage<span style="color:#719e07">(),</span> list<span style="color:#719e07">.</span>toArray<span style="color:#719e07">()).</span>getMessage<span style="color:#719e07">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#719e07">}</span> <span style="color:#719e07">catch</span> <span style="color:#719e07">(</span>Exception e<span style="color:#719e07">)</span> <span style="color:#719e07">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#719e07">return</span> event<span style="color:#719e07">.</span>getFormattedMessage<span style="color:#719e07">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#719e07">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#719e07">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#719e07">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></div></div>
      <div class="site-comment"></div>
      <div class="site-right">
        <div class="series-container">
          <div class="series-toggle"><i class="fas fa-book"></i></div>
          <div id="SeriesList" class="series-content"><a class="series-title" href="/series/java/">Java</a><ul class="series-list"><li>
    <a class="series-item" href="/series/java/logback-%E8%87%AA%E5%8A%A8-json-%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E8%BD%AC%E6%8D%A2%E5%99%A8%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/">Logback è‡ªåŠ¨ Json åºåˆ—åŒ–å’Œè½¬æ¢å™¨åŸç†è§£æ</a></li><li>
    <a class="series-item" href="/series/java/lombok-%E4%B8%AD-data-%E5%92%8C-builder-%E5%90%88%E7%94%A8%E4%BA%A7%E7%94%9F%E7%9A%84%E9%97%AE%E9%A2%98/">Lombok ä¸­ Data å’Œ Builder åˆç”¨äº§ç”Ÿçš„é—®é¢˜</a></li></ul>
          </div>
        </div>
      </div>
    </div><div id="fastSearch">
  <div class="fast-search-container">
    <div class="fast-search-header">
      <input id="searchInput" tabindex="-1" disabled autocomplete="off">
      <span class="fast-search-hint" id="searchHint">CTRL-/</span>
    </div>
    <ul id="searchResults">
      <div id="searchLoading" class="lds-default"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div>
    </ul>
  </div>
</div>
<script src="/js/fuse.min.js"></script>
<script src="/js/fastsearch.js"></script><footer class="site-footer" id="SiteFooter"><div class="footer-poweredby">
    <span>Powered by <a href="https://gohugo.io" target="_blank">Hugo</a></span>
    <span class="division">|</span>
    <span>Theme - <a href="https://github.com/alohaia/hugo-theme-daisilia" target="_blank">Daisilia</a></span>
</div><div class="footer-copyright">Â© 2016 - 2023<span class="heart animate__heartBeat animate__infinite"><i class="fas fa-heart"></i></span>
    <span><a href="https://kushnee.github.io" target="_blank">Kush Nee</a></span>
</div><div class="footer-creativecommons">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</div></footer>
    <aside class="site-sidebar" id="SiteSidebar"><div class="sidebar-container">
  <div class="sidebar-nav" data-pjax><span role="button" class="sidebar-nav-item sidebar-nav-series">Table of Contents</span>
      <span role="button" class="sidebar-nav-item sidebar-nav-overview">Overview</span></div>
  <div class="sidebar-content">
    <div class="sidebar-toc sidebar-pannel" data-pjax><h1 class="toc-title" id="TOCTitle">Logback è‡ªåŠ¨ Json åºåˆ—åŒ–å’Œè½¬æ¢å™¨åŸç†è§£æ</h1><nav id="TableOfContents">
  <ul>
    <li><a href="#å¦‚ä½•è‡ªåŠ¨å¯¹å¯¹è±¡è¿›è¡Œ-json-åºåˆ—åŒ–">å¦‚ä½•è‡ªåŠ¨å¯¹å¯¹è±¡è¿›è¡Œ json åºåˆ—åŒ–</a>
      <ul>
        <li><a href="#å‰æƒ…æè¦">å‰æƒ…æè¦</a></li>
        <li><a href="#æ–¹æ¡ˆè®¾è®¡">æ–¹æ¡ˆè®¾è®¡</a></li>
        <li><a href="#å…·ä½“å®ç°">å…·ä½“å®ç°</a></li>
      </ul>
    </li>
    <li><a href="#logback-è½¬æ¢å™¨åŸç†åˆ†æ">logback è½¬æ¢å™¨åŸç†åˆ†æ</a>
      <ul>
        <li><a href="#springboot-åŠ è½½-logback-é…ç½®æ–‡ä»¶">springboot åŠ è½½ logback é…ç½®æ–‡ä»¶</a></li>
        <li><a href="#logback-å®Œæˆé…ç½®åˆå§‹åŒ–">logback å®Œæˆé…ç½®åˆå§‹åŒ–</a></li>
        <li><a href="#logger-çš„å…·ä½“è°ƒç”¨">Logger çš„å…·ä½“è°ƒç”¨</a></li>
      </ul>
    </li>
    <li><a href="#æ€»ç»“">æ€»ç»“</a></li>
  </ul>
</nav></div>
    <div class="sidebar-overview sidebar-pannel">
      <div class="sidebar-avatar">
        <a href="/about"><img class="site-avatar-image" alt="KCN" src="/images/avatar.png"></a>
      </div>
      <p class="site-author-name">Kush Nee</p>
      <p class="site-description">PT &amp; Code</p><div class="site-overview">
        <a class="site-overview-item" href="/">
          <p class="site-overview-num">5</p>
          <p class="site-overview-name">Pages</p>
        </a>
        <a class="site-overview-item" href="/tags">
          <p class="site-overview-num">5</p>
          <p class="site-overview-name">Tags</p>
        </a>
        <a class="site-overview-item" href="/series">
          <p class="site-overview-num">4</p>
          <p class="site-overview-name">Series</p>
        </a>
      </div><div class="sidebar-quote collapsed"><p class="sidebar-quote-content">ğŸŒˆ è·å–ä¸­...</p>
  <p class="rainbow-from"></p></div></div>
  </div>
  <div class="back2top" id="Back2top" role="button">
    <i class="back2top-icon fas fa-angle-double-up"></i>
    <span class="back2top-progress" id="Back2topProgress"></span>
  </div>
</div>
<div class="sidebar-toggle" id="SidebarToggle" role="button">
  <i class="sidebar-toggle-icon right-arrow">&#xf061</i>
  <i class="sidebar-toggle-icon bars">&#xf0c9</i>
  <i class="sidebar-toggle-icon left-arrow">&#xf060</i>
</div>
<div id="SidebarFill"></div></aside>
  </div>
  <div class="loading-track"><div class="loading-progress"></div></div>

<script src="/js/fancybox.umd.js"></script>
<link rel="stylesheet" type="text/css" href="/css/fancybox.css">
<script type="module">
  Fancybox.bind("[data-fancybox]", {
    groupAll: true,
    hideScrollbar: true, 
    caption: function(instance, slide, caption){
      const figcaption = slide.triggerEl?.querySelector("figcaption .title");
      return figcaption ? figcaption.innerHTML : slide.caption || "";
    }
  });
</script>

<script src="/js/daisy.js"></script>
<script data-pjax src="/js/daisy.each.js"></script>
<script src="/js/pjax.js"></script>
<script src="/js/pjax.user.js"></script>
<script>
  fetch('https://api.eatrice.top')
  .then(response => response.json())
  .then(data => {
    var sidebar_quote_content = document.querySelector('.sidebar-quote-content');
    var sidebar_quote_from = document.querySelector('.sidebar-quote-from');
    sidebar_quote_content.innerHTML = data.Content;
    if(data.Author == 'unknown' && data.Source == 'unknown') {
      sidebar_quote_from.setAttribute('visibility', 'hidden');
    } else {
      var from_text = "â€”";
      if(data.Author != 'unknown') {
        from_text += ' ' + data.Author;
      }
      if(data.Source != 'unknown') {
        from_text += 'ã€Š' + data.Source + 'ã€‹';
      }
      sidebar_quote_from.innerHTML = from_text;
    }
  })
  .catch(console.error)
</script></body>
</html>